{"version":3,"file":"StorageFile.js","names":["_Function","require","HashMap","_interopRequireWildcard","Effect","Layer","Queue","Schema","Pod","PodAddress","ShardId","Storage","Stream","fs","_utils","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","PODS_FILE","ASSIGNMENTS_FILE","AssignmentsSchema","array","tuple","schema","optionFromNullable","PodsSchema","writeJsonData","fileName","data","pipe","jsonStringify","flatMap","sync","writeFileSync","orDie","readJsonData","empty","existsSync","exists","readFileSync","jsonParse","toString","succeed","getAssignments","map","fromIterable","saveAssignments","assignments","Array","from","getPods","savePods","pods","getChangesStream","unbounded","queue","acquireRelease","watchFile","runSync","offer","watcher","zip","shutdown","unref","concurrent","_","fromQueue","unwrapScoped","assignmentsStream","mapEffect","storageFile","scoped","exports"],"sources":["../../src/StorageFile.ts"],"sourcesContent":[null],"mappings":"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"}