{"version":3,"file":"StorageFile.js","names":["HashMap","_interopRequireWildcard","require","Effect","Layer","Queue","Schema","Pod","PodAddress","ShardId","Storage","Stream","fs","_utils","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","PODS_FILE","ASSIGNMENTS_FILE","AssignmentsSchema","array","tuple","schema","optionFromNullable","PodsSchema","writeJsonData","fileName","data","orDie","flatMap","sync","writeFileSync","jsonStringify","readJsonData","empty","exists","jsonParse","toString","readFileSync","succeed","existsSync","getAssignments","map","fromIterable","saveAssignments","assignments","Array","from","getPods","savePods","pods","getChangesStream","unwrapScoped","queue","_","fromQueue","acquireRelease","watchFile","runSync","offer","watcher","zip","shutdown","unref","concurrent","unbounded","assignmentsStream","mapEffect","storageFile","scoped","exports"],"sources":["../../src/StorageFile.ts"],"sourcesContent":[null],"mappings":"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"}