{"version":3,"file":"EntityManager.js","names":["Duration","_interopRequireWildcard","require","HashMap","HashSet","Option","Effect","Fiber","Queue","RefSynchronized","ShardError","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","make","recipientType","behavior_","interruptible","sharding","config","entityMaxIdle","gen","$","entities","empty","env","context","behavior","entityId","dequeue","provideContext","startExpirationFiber","forkDaemon","asUnit","zipRight","forkEntityTermination","sleep","getOrElse","entityMaxIdleTime","modifyEffect","map","match","onNone","succeed","none","onSome","maybeQueue","expirationFiber","runningFiber","some","queue","as","interruptFork","shutdown","send","req","replyId","replyChannel","decide","flatMap","isShuttingDown","isGoingDown","fail","EntityNotManagedByThisPod","_","unbounded","executionFiber","catchAllCause","logError","ensuring","interrupt","update","remove","someQueue","interruptionFiber","fiber","tap","millis","e","logDebug","zipLeft","offer","end","replyId_","initReply","test","bind","unit","die","Do","terminateAllEntities","terminateEntities","keySet","entitiesToTerminate","forEach","await","concurrency","terminateEntitiesOnShards","shards","modify","filter","getShardId","self"],"sources":["../../src/EntityManager.ts"],"sourcesContent":[null],"mappings":"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"}