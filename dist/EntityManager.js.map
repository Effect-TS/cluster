{"version":3,"file":"EntityManager.js","names":["Duration","_interopRequireWildcard","require","HashMap","HashSet","Option","Deferred","Effect","Fiber","Queue","RefSynchronized","ShardError","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","make","recipientType","behavior_","terminateMessage","sharding","config","entityMaxIdle","gen","$","entities","empty","env","context","behavior","entityId","dequeue","terminatedSignal","provideContext","startExpirationFiber","forkDaemon","interruptible","zipRight","asUnit","terminateEntity","sleep","getOrElse","entityMaxIdleTime","updateEffect","map","match","onNone","succeed","onSome","maybeQueue","interruptionFiber","queue","as","remove","shutdown","msg","none","exit","offer","send","req","replyId","replyChannel","decide","flatMap","isShuttingDown","isGoingDown","fail","EntityNotManagedByThisPod","_","unbounded","expirationFiber","catchAllCause","ensuring","interrupt","update","logError","someQueue","some","fiber","tap","millis","e","logDebug","zipLeft","end","replyId_","initReply","test","bind","modifyEffect","unit","die","Do","terminateAllEntities","terminateEntities","entitiesToTerminate","forEach","__","await","terminateEntitiesOnShards","shards","modify","filter","getShardId","self"],"sources":["../../src/EntityManager.ts"],"sourcesContent":[null],"mappings":"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"}