{"version":3,"file":"StorageFile.mjs","names":["HashMap","Effect","Layer","Queue","Schema","Pod","PodAddress","ShardId","Storage","Stream","fs","jsonParse","jsonStringify","PODS_FILE","ASSIGNMENTS_FILE","AssignmentsSchema","array","tuple","schema","optionFromNullable","PodsSchema","writeJsonData","fileName","data","orDie","flatMap","sync","writeFileSync","readJsonData","empty","exists","toString","readFileSync","succeed","existsSync","getAssignments","map","fromIterable","saveAssignments","assignments","Array","from","getPods","savePods","pods","getChangesStream","unwrapScoped","queue","_","fromQueue","acquireRelease","watchFile","runSync","offer","watcher","zip","shutdown","unref","concurrent","unbounded","assignmentsStream","mapEffect","storageFile","scoped"],"sources":["../../src/StorageFile.ts"],"sourcesContent":[null],"mappings":"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"}