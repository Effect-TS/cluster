{"version":3,"file":"EntityManager.mjs","names":["Duration","HashMap","HashSet","Option","Effect","Fiber","Queue","RefSynchronized","PoisonPill","ShardError","make","recipientType","behavior_","sharding","config","entityMaxIdle","gen","$","entities","empty","env","context","behavior","entityId","dequeue","provideContext","startExpirationFiber","forkDaemon","interruptible","asUnit","zipRight","forkEntityTermination","sleep","getOrElse","entityMaxIdleTime","modifyEffect","map","match","onNone","succeed","none","onSome","maybeQueue","expirationFiber","runningFiber","some","queue","as","set","offer","get","send","req","replyId","replyChannel","decide","flatMap","isShuttingDown","isGoingDown","fail","EntityNotManagedByThisPod","_","unbounded","executionFiber","ensuring","interrupt","shutdown","update","remove","someQueue","interruptionFiber","fiber","tap","millis","catchAllCause","e","logDebug","zipLeft","end","replyId_","initReply","test","bind","_tag","unlessEffect","isEntityOnLocalShards","unit","die","Do","terminateAllEntities","terminateEntities","keySet","entitiesToTerminate","forEach","timeout","entityTerminationTimeout","await","concurrency","terminateEntitiesOnShards","shards","modify","filter","has","getShardId","self"],"sources":["../../src/EntityManager.ts"],"sourcesContent":[null],"mappings":"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"}