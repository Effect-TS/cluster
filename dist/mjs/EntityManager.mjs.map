{"version":3,"file":"EntityManager.mjs","names":["Duration","HashMap","HashSet","Option","Effect","Fiber","Queue","RefSynchronized","ShardError","make","recipientType","behavior_","interruptible","sharding","config","entityMaxIdle","gen","$","entities","empty","env","context","behavior","entityId","dequeue","provideContext","startExpirationFiber","forkDaemon","asUnit","zipRight","forkEntityTermination","sleep","getOrElse","entityMaxIdleTime","modifyEffect","map","match","onNone","succeed","none","onSome","maybeQueue","expirationFiber","runningFiber","some","queue","as","set","interruptFork","shutdown","get","send","req","replyId","replyChannel","decide","flatMap","isShuttingDown","isGoingDown","fail","EntityNotManagedByThisPod","_","unbounded","executionFiber","catchAllCause","logError","ensuring","interrupt","update","remove","someQueue","interruptionFiber","fiber","tap","millis","e","logDebug","zipLeft","offer","end","replyId_","initReply","test","bind","unit","die","Do","terminateAllEntities","terminateEntities","keySet","entitiesToTerminate","forEach","await","concurrency","terminateEntitiesOnShards","shards","modify","filter","has","getShardId","self"],"sources":["../../src/EntityManager.ts"],"sourcesContent":[null],"mappings":"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"}