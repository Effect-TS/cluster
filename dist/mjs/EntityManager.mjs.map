{"version":3,"file":"EntityManager.mjs","names":["Duration","HashMap","HashSet","Option","Effect","Fiber","RefSynchronized","MessageQueue","PoisonPill","ShardingError","make","recipientType","behaviour_","sharding","config","options","gen","_","entityMaxIdle","entityMaxIdleTime","none","messageQueueConstructor","inMemory","env","context","entities","empty","behaviour","entityId","dequeue","provideContext","startExpirationFiber","forkDaemon","interruptible","asUnit","zipRight","forkEntityTermination","sleep","getOrElse","modifyEffect","map","match","onNone","succeed","onSome","maybeQueue","expirationFiber","runningFiber","some","queue","as","set","catchAllCause","logError","offer","get","send","req","replyId","replyChannel","decide","flatMap","isShuttingDown","isGoingDown","fail","ShardingEntityNotManagedByThisPodError","provideSomeContext","executionFiber","ensuring","interrupt","shutdown","update","remove","interruptionFiber","fiber","tap","millis","messageQueue","e","logDebug","zipLeft","end","replyId_","initReply","test","bind","_tag","unlessEffect","isEntityOnLocalShards","unit","die","Do","terminateAllEntities","terminateEntities","keySet","entitiesToTerminate","forEach","name","toMillis","entityTerminationTimeout","timeout","await","concurrency","terminateEntitiesOnShards","shards","modify","filter","has","getShardId","self"],"sources":["../../src/EntityManager.ts"],"sourcesContent":[null],"mappings":"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"}