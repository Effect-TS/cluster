{"version":3,"file":"EntityManager.mjs","names":["Duration","HashMap","HashSet","Option","Effect","Fiber","Queue","RefSynchronized","PoisonPill","ShardError","make","layerScope","recipientType","recipientBehaviour","sharding","config","entityMaxIdle","gen","$","entities","empty","env","context","behavior","entityId","dequeue","provideContext","accept","msg","startExpirationFiber","forkDaemon","interruptible","asUnit","zipRight","forkEntityTermination","sleep","getOrElse","entityMaxIdleTime","modifyEffect","map","match","onNone","succeed","none","onSome","maybeQueue","expirationFiber","runningFiber","some","queue","as","set","offer","get","send","req","replyId","replyChannel","decide","flatMap","isShuttingDown","isGoingDown","fail","EntityNotManagedByThisPod","_","unbounded","executionFiber","ensuring","interrupt","shutdown","update","remove","someQueue","interruptionFiber","fiber","tap","millis","catchAllCause","e","logDebug","zipLeft","end","replyId_","initReply","test","bind","_tag","unlessEffect","isEntityOnLocalShards","unit","die","Do","terminateAllEntities","terminateEntities","keySet","entitiesToTerminate","forEach","logError","name","toMillis","entityTerminationTimeout","timeout","await","concurrency","terminateEntitiesOnShards","shards","modify","filter","has","getShardId","self"],"sources":["../../src/EntityManager.ts"],"sourcesContent":[null],"mappings":"AAAA;;;AAGA,OAAO,KAAKA,QAAQ,MAAM,uBAAuB;AAEjD,OAAO,KAAKC,OAAO,MAAM,sBAAsB;AAC/C,OAAO,KAAKC,OAAO,MAAM,sBAAsB;AAC/C,OAAO,KAAKC,MAAM,MAAM,qBAAqB;AAC7C,OAAO,KAAKC,MAAM,MAAM,mBAAmB;AAC3C,OAAO,KAAKC,KAAK,MAAM,kBAAkB;AACzC,OAAO,KAAKC,KAAK,MAAM,kBAAkB;AACzC,OAAO,KAAKC,eAAe,MAAM,6BAA6B;AAE9D,OAAO,KAAKC,UAAU,MAAM,8BAA8B;AAK1D,OAAO,KAAKC,UAAU,MAAM,8BAA8B;AA4B1D;;;;AAIA,OAAM,SAAUC,IAAIA,CAClBC,UAAuB,EACvBC,aAA+C,EAC/CC,kBAAiE,EACjEC,QAA2B,EAC3BC,MAAqC,EACrCC,aAA+C;EAE/C,OAAOZ,MAAM,CAACa,GAAG,CAAC,WAAUC,CAAC;IAC3B,MAAMC,QAAQ,GAAG,OAAOD,CAAC,CACvBX,eAAe,CAACG,IAAI,CAKlBT,OAAO,CAACmB,KAAK,EAAE,CAAC,CACnB;IACD,MAAMC,GAAG,GAAG,OAAOH,CAAC,CAACd,MAAM,CAACkB,OAAO,EAAK,CAAC;IACzC,MAAMC,QAAQ,GAAGA,CACfC,QAAgB,EAChBC,OAAmD,KAChDrB,MAAM,CAACsB,cAAc,CAACb,kBAAkB,CAACY,OAAO,CAACD,QAAQ,EAAEC,OAAO,CAAC,EAAEJ,GAAG,CAAC;IAC9E,MAAMM,MAAM,GAAIC,GAAQ,IAAKxB,MAAM,CAACsB,cAAc,CAACb,kBAAkB,CAACc,MAAM,CAACC,GAAG,CAAC,EAAEP,GAAG,CAAC;IAEvF,SAASQ,oBAAoBA,CAACL,QAAgB;MAC5C,OAUEpB,MAAM,CAAC0B,UAAU,CADjB1B,MAAM,CAAC2B,aAAa,CADpB3B,MAAM,CAAC4B,MAAM,CADb5B,MAAM,CAAC6B,QAAQ,CAACC,qBAAqB,CAACV,QAAQ,CAAC,CAAC,CANhDpB,MAAM,CAAC+B,KAAK,CAGRhC,MAAM,CAACiC,SAAS,CAAC,MAAMrB,MAAM,CAACsB,iBAAiB,CAAC,CADhDrB,aAAa,CAEd,CACF;IAML;IAEA,SAASkB,qBAAqBA,CAACV,QAAgB;MAC7C,OAAOjB,eAAe,CAAC+B,YAAY,CAACnB,QAAQ,EAAGoB,GAAG,IAG9CpC,MAAM,CAACqC,KAAK,CAAC;QACX;QACAC,MAAM,EAAEA,CAAA,KAAMrC,MAAM,CAACsC,OAAO,CAAC,CAACvC,MAAM,CAACwC,IAAI,EAAE,EAAEJ,GAAG,CAAU,CAAC;QAC3D;QACAK,MAAM,EAAEA,CAAC,CAACC,UAAU,EAAEC,eAAe,EAAEC,YAAY,CAAC,KAGhD5C,MAAM,CAACqC,KAAK,CAAC;UACX;UACAC,MAAM,EAAEA,CAAA,KAAMrC,MAAM,CAACsC,OAAO,CAAC,CAACvC,MAAM,CAAC6C,IAAI,CAACD,YAAY,CAAC,EAAER,GAAG,CAAU,CAAC;UACvE;UACAK,MAAM,EAAGK,KAAK,IAGV7C,MAAM,CAAC8C,EAAE,CACP,CACE/C,MAAM,CAAC6C,IAAI,CAACD,YAAY,CAAC,EACzB9C,OAAO,CAACkD,GAAG,CAACZ,GAAG,EAAEf,QAAQ,EAAE,CACzBrB,MAAM,CAACwC,IAAI,EAAE,EACbG,eAAe,EACfC,YAAY,CACb,CAAC,CACM,CACX,CAVDzC,KAAK,CAAC8C,KAAK,CAACH,KAAK,EAAEzC,UAAU,CAACE,IAAI,CAAC;SAYxC,CAAC,CAnBFmC,UAAU;OAqBf,CAAC,CA5BF5C,OAAO,CAACoD,GAAG,CAACd,GAAG,EAAEf,QAAQ,CAAC,CA6B3B,CAAC;IACN;IAEA,SAAS8B,IAAIA,CACX9B,QAAgB,EAChB+B,GAAQ,EACRC,OAAuC,EACvCC,YAA4C;MAE5C,SAASC,MAAMA,CACbnB,GAGC,EACDf,QAAgB;QAEhB,OAEErB,MAAM,CAACqC,KAAK,CAAC;UACXC,MAAM,EAAEA,CAAA,KACNrC,MAAM,CAACuD,OAAO,CAAC7C,QAAQ,CAAC8C,cAAc,EAAGC,WAAW,IAAI;YACtD,IAAIA,WAAW,EAAE;cACf;cACA,OAAOzD,MAAM,CAAC0D,IAAI,CAACrD,UAAU,CAACsD,yBAAyB,CAACvC,QAAQ,CAAC,CAAC;aACnE,MAAM;cACL;cACA,OAAOpB,MAAM,CAACa,GAAG,CAAC,WAAU+C,CAAC;gBAC3B,MAAMf,KAAK,GAAG,OAAOe,CAAC,CAAC1D,KAAK,CAAC2D,SAAS,EAA+B,CAAC;gBACtE,MAAMnB,eAAe,GAAG,OAAOkB,CAAC,CAACnC,oBAAoB,CAACL,QAAQ,CAAC,CAAC;gBAChE,MAAM0C,cAAc,GAAG,OAAOF,CAAC,CAU3B5D,MAAM,CAAC0B,UAAU,CAPjB1B,MAAM,CAAC+D,QAAQ,CAIX/D,MAAM,CAAC6B,QAAQ,CAAC5B,KAAK,CAAC+D,SAAS,CAACtB,eAAe,CAAC,CAAC,CADjD1C,MAAM,CAAC6B,QAAQ,CAAC3B,KAAK,CAAC+D,QAAQ,CAACpB,KAAK,CAAC,CAAC,CADtC1C,eAAe,CAAC+D,MAAM,CAACnD,QAAQ,EAAElB,OAAO,CAACsE,MAAM,CAAC/C,QAAQ,CAAC,CAAC,EAG3D,CACF,CAPDD,QAAQ,CAACC,QAAQ,EAAEyB,KAAK,CAAC,EAS1B,CACF;gBAED,MAAMuB,SAAS,GAAGrE,MAAM,CAAC6C,IAAI,CAACC,KAAK,CAAC;gBACpC,OAAO,CACLuB,SAAS,EACTvE,OAAO,CAACkD,GAAG,CAACZ,GAAG,EAAEf,QAAQ,EAAE,CAACgD,SAAS,EAAE1B,eAAe,EAAEoB,cAAc,CAAU,CAAC,CACzE;cACZ,CAAC,CAAC;;UAEN,CAAC,CAAC;UACJtB,MAAM,EAAEA,CAAC,CAACC,UAAU,EAAE4B,iBAAiB,EAAEP,cAAc,CAAC,KAGpD/D,MAAM,CAACqC,KAAK,CAAC;YACX;YACAI,MAAM,EAAEA,CAAA,KAIJxC,MAAM,CAACmC,GAAG,CACPmC,KAAK,IACJ,CACE7B,UAAU,EACV5C,OAAO,CAACkD,GAAG,CAACZ,GAAG,EAAEf,QAAQ,EAAE,CAACqB,UAAU,EAAE6B,KAAK,EAAER,cAAc,CAAU,CAAC,CAChE,CACb,CAPD9D,MAAM,CAAC6B,QAAQ,CAACJ,oBAAoB,CAACL,QAAQ,CAAC,CAAC,CAD/CnB,KAAK,CAAC+D,SAAS,CAACK,iBAAiB,CAAC,EASnC;YACH;YACAhC,MAAM,EAAEA,CAAA,KAAMrC,MAAM,CAACsC,OAAO,CAAC,CAACvC,MAAM,CAACwC,IAAI,EAAE,EAAEJ,GAAG,CAAU;WAC3D,CAAC,CAjBFM,UAAU;SAmBf,CAAC,CAvDF5C,OAAO,CAACoD,GAAG,CAACd,GAAG,EAAEf,QAAQ,CAAC;MAyD9B;MAEA,OAeEpB,MAAM,CAACuE,GAAG,CAAEX,CAAC,IAGT7D,MAAM,CAACqC,KAAK,CAAC;QACXC,MAAM,EAAEA,CAAA,KAGJrC,MAAM,CAAC6B,QAAQ,CAACqB,IAAI,CAAC9B,QAAQ,EAAE+B,GAAG,EAAEC,OAAO,EAAEC,YAAY,CAAC,CAAC,CAD3DrD,MAAM,CAAC+B,KAAK,CAACnC,QAAQ,CAAC4E,MAAM,CAAC,GAAG,CAAC,CAAC,CAEnC;QACHhC,MAAM,EAAGK,KAAK,IAAI;UAChB,OAgBE7C,MAAM,CAACyE,aAAa,CAAEC,CAAC,IAGnB1E,MAAM,CAAC6B,QAAQ,CAACqB,IAAI,CAAC9B,QAAQ,EAAE+B,GAAG,EAAEC,OAAO,EAAEC,YAAY,CAAC,CAAC,CAD3DrD,MAAM,CAAC2E,QAAQ,CAAC,uCAAuC,EAAED,CAAC,CAAC,CAE5D,CACF,CAnBD3E,MAAM,CAACqC,KAAK,CAAC;YACXC,MAAM,EAAEA,CAAA,KAIJrC,MAAM,CAAC4E,OAAO,CAACvB,YAAY,CAACwB,GAAG,CAAC,CADhC7E,MAAM,CAAC6B,QAAQ,CAAC3B,KAAK,CAAC8C,KAAK,CAACH,KAAK,EAAEM,GAAG,CAAC,CAAC,CADxC5B,MAAM,CAAC4B,GAAG,CAAC,EAGZ;YACHX,MAAM,EAAGsC,QAAQ,IAIb9E,MAAM,CAAC6B,QAAQ,CAAC3B,KAAK,CAAC8C,KAAK,CAACH,KAAK,EAAEM,GAAG,CAAC,CAAC,CADxCnD,MAAM,CAAC6B,QAAQ,CAACnB,QAAQ,CAACqE,SAAS,CAACD,QAAQ,EAAEzB,YAAY,CAAC,CAAC,CAD3D9B,MAAM,CAAC4B,GAAG,CAAC;WAIhB,CAAC,CAdFC,OAAO;QAsBX;OACD,CAAC,CAhCFQ,CAAC,CAACoB,IAAI,CAiCP,CACF,CArCDhF,MAAM,CAACiF,IAAI,CAAC,MAAM,EAAE,MAAM9E,eAAe,CAAC+B,YAAY,CAACnB,QAAQ,EAAGoB,GAAG,IAAKmB,MAAM,CAACnB,GAAG,EAAEf,QAAQ,CAAC,CAAC,CAAC,CAZjGpB,MAAM,CAACuE,GAAG,CAAC,MAAK;QACd;QACA,IAAI/D,aAAa,CAAC0E,IAAI,KAAK,YAAY,EAAE;UACvC,OAAOlF,MAAM,CAAC4B,MAAM,CAAC5B,MAAM,CAACmF,YAAY,CACtCnF,MAAM,CAAC0D,IAAI,CAACrD,UAAU,CAACsD,yBAAyB,CAACvC,QAAQ,CAAC,CAAC,EAC3DV,QAAQ,CAAC0E,qBAAqB,CAAC5E,aAAa,EAAEY,QAAQ,CAAC,CACxD,CAAC;SACH,MAAM,IAAIZ,aAAa,CAAC0E,IAAI,KAAK,WAAW,EAAE;UAC7C,OAAOlF,MAAM,CAACqF,IAAI;;QAEpB,OAAOrF,MAAM,CAACsF,GAAG,CAAC,yBAAyB,CAAC;MAC9C,CAAC,CAAC,CAZFtF,MAAM,CAACuF,EAAE;IAoDb;IAEA,MAAMC,oBAAoB,GAGxBxF,MAAM,CAACuD,OAAO,CAACkC,iBAAiB,CAAC,CADjCzF,MAAM,CAACmC,GAAG,CAACtC,OAAO,CAAC6F,MAAM,CAAC,CAD1BvF,eAAe,CAAC8C,GAAG,CAAClC,QAAQ,CAAC,EAG9B;IAED,SAAS0E,iBAAiBA,CACxBE,mBAEC;MAED,OAiCE3F,MAAM,CAAC4B,MAAM,CA/Bb5B,MAAM,CAAC4F,OAAO,CACXxE,QAAQ,IAGLpB,MAAM,CAACuD,OAAO,CAACxD,MAAM,CAACqC,KAAK,CAAC;QAC1BC,MAAM,EAAEA,CAAA,KAAMrC,MAAM,CAACqF,IAAI;QACzB7C,MAAM,EAAGsB,cAAc,IAmBnB9D,MAAM,CAAC4B,MAAM,CAdb5B,MAAM,CAACuD,OAAO,CAACxD,MAAM,CAACqC,KAAK,CAAC;UAC1BC,MAAM,EAAEA,CAAA,KACNrC,MAAM,CAAC6F,QAAQ,CACb,UACErF,aAAa,CAACsF,IAAI,GAAG,GAAG,GAAG1E,QAC7B,wDACExB,QAAQ,CAACmG,QAAQ,CAACpF,MAAM,CAACqF,wBAAwB,CACnD,kEAAkE,CACnE;UACHxD,MAAM,EAAEA,CAAA,KACNxC,MAAM,CAAC2E,QAAQ,CACb,UAAUnE,aAAa,CAACsF,IAAI,GAAG,GAAG,GAAG1E,QAAQ,cAAc;SAEhE,CAAC,CAAC,CAdHpB,MAAM,CAACiG,OAAO,CAACtF,MAAM,CAACqF,wBAAwB,CAAC,CAD/ChG,MAAM,CAAC6B,QAAQ,CAAC5B,KAAK,CAACiG,KAAK,CAACpC,cAAc,CAAC,CAAC,CAD5C9D,MAAM,CAAC2E,QAAQ,CAAC,0BAA0B,GAAGvD,QAAQ,CAAC;OAmB3D,CAAC,CAAC,CAxBHU,qBAAqB,CAACV,QAAQ,CAAC,CAyBhC,EACH;QAAE+E,WAAW,EAAE;MAAS,CAAE,CAC3B,CA/BDR,mBAAmB;IAkCvB;IAEA,SAASS,yBAAyBA,CAACC,MAAwC;MACzE,OASErG,MAAM,CAACuD,OAAO,CAACkC,iBAAiB,CAAC,CADjCzF,MAAM,CAACmC,GAAG,CAACtC,OAAO,CAAC6F,MAAM,CAAC,CAP1BvF,eAAe,CAACmG,MAAM,CAACvF,QAAQ,EAAGA,QAAQ,IAAK,CAC7ClB,OAAO,CAAC0G,MAAM,CACZxF,QAAQ,EACR,CAAC6C,CAAC,EAAExC,QAAQ,KAAKtB,OAAO,CAAC0G,GAAG,CAACH,MAAM,EAAE3F,QAAQ,CAAC+F,UAAU,CAACjG,aAAa,EAAEY,QAAQ,CAAC,CAAC,CACnF,EACDL,QAAQ,CACT,CAAC;IAIN;IAEA,MAAM2F,IAAI,GAAuB;MAAExD,IAAI;MAAEsC,oBAAoB;MAAEY;IAAyB,CAAE;IAC1F,OAAOM,IAAI;EACb,CAAC,CAAC;AACJ"}