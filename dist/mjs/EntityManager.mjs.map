{"version":3,"file":"EntityManager.mjs","names":["Duration","HashMap","HashSet","Option","Deferred","Effect","Fiber","Queue","RefSynchronized","ShardError","make","recipientType","behavior_","terminateMessage","sharding","config","entityMaxIdle","gen","$","entities","empty","env","context","behavior","entityId","dequeue","provideContext","startExpirationFiber","forkDaemon","interruptible","zipRight","asUnit","terminateEntity","sleep","getOrElse","entityMaxIdleTime","updateEffect","map","match","onNone","succeed","onSome","maybeQueue","interruptionFiber","queue","flatMap","p","as","shutdown","remove","msg","exit","offer","set","none","get","send","req","replyId","replyChannel","decide","test","isSome","value","fiber","interrupt","isNone","isShuttingDown","isGoingDown","fail","EntityNotManagedByThisPod","_","someQueue","expirationFiber","let","some","tap","ensuring","update","bind","unbounded","Do","millis","catchAllCause","e","logCause","message","zipLeft","end","replyId_","initReply","modifyEffect","_tag","unlessEffect","isEntityOnLocalShards","unit","die","terminateAllEntities","getAndSet","terminateEntities","entitiesToTerminate","promises","timeout","forEach","await","discard","entityTerminationTimeout","queue_","__","terminate","terminateEntitiesOnShards","shards","modify","filter","has","getShardId","self"],"sources":["../../src/EntityManager.ts"],"sourcesContent":[null],"mappings":"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"}