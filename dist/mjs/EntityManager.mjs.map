{"version":3,"file":"EntityManager.mjs","names":["Duration","HashMap","HashSet","Option","Deferred","Effect","Fiber","Queue","RefSynchronized","ShardError","make","recipientType","behavior_","terminateMessage","sharding","config","entityMaxIdle","gen","$","entities","empty","env","context","behavior","entityId","dequeue","terminatedSignal","provideContext","startExpirationFiber","forkDaemon","interruptible","zipRight","asUnit","terminateEntity","sleep","getOrElse","entityMaxIdleTime","updateEffect","map","match","onNone","succeed","onSome","maybeQueue","interruptionFiber","queue","as","remove","shutdown","msg","set","none","exit","offer","get","send","req","replyId","replyChannel","decide","flatMap","isShuttingDown","isGoingDown","fail","EntityNotManagedByThisPod","_","unbounded","expirationFiber","catchAllCause","ensuring","interrupt","update","logError","someQueue","some","fiber","tap","millis","e","logDebug","zipLeft","end","replyId_","initReply","test","bind","modifyEffect","unit","die","Do","terminateAllEntities","terminateEntities","entitiesToTerminate","forEach","__","await","terminateEntitiesOnShards","shards","modify","filter","has","getShardId","self"],"sources":["../../src/EntityManager.ts"],"sourcesContent":[null],"mappings":"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"}