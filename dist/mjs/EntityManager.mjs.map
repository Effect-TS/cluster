{"version":3,"file":"EntityManager.mjs","names":["Duration","HashMap","HashSet","Option","Deferred","Effect","Fiber","Queue","RefSynchronized","ShardError","make","recipientType","behavior_","terminateMessage","sharding","config","entityMaxIdle","gen","$","entities","empty","env","context","behavior","entityId","dequeue","provideContext","startExpirationFiber","forkDaemon","interruptible","zipRight","asUnit","terminateEntity","sleep","getOrElse","entityMaxIdleTime","updateEffect","map","match","onNone","succeed","onSome","maybeQueue","interruptionFiber","queue","flatMap","p","as","shutdown","remove","msg","exit","offer","set","none","get","send","req","replyId","replyChannel","decide","test","isSome","value","fiber","interrupt","isNone","isShuttingDown","isGoingDown","fail","EntityNotManagedByThisPod","_","someQueue","expirationFiber","let","some","tap","ensuring","update","bind","unbounded","Do","millis","catchAllCause","zipLeft","end","replyId_","initReply","modifyEffect","_tag","unlessEffect","isEntityOnLocalShards","unit","die","terminateAllEntities","getAndSet","terminateEntities","entitiesToTerminate","promises","timeout","forEach","await","discard","entityTerminationTimeout","queue_","__","terminate","terminateEntitiesOnShards","shards","modify","filter","has","getShardId","self"],"sources":["../../src/EntityManager.ts"],"sourcesContent":[null],"mappings":"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"}