{"version":3,"file":"EntityManager.mjs","names":["Duration","HashMap","HashSet","Option","Effect","Fiber","RefSynchronized","Scope","PoisonPill","ShardError","make","layerScope","recipientType","behaviour_","sharding","config","messageQueue","entityMaxIdle","gen","_","entities","empty","env","context","behaviour","entityId","dequeue","provideContext","startExpirationFiber","forkDaemon","interruptible","asUnit","zipRight","forkEntityTermination","sleep","getOrElse","entityMaxIdleTime","modifyEffect","map","match","onNone","succeed","none","onSome","maybeQueue","expirationFiber","runningFiber","some","queue","as","set","offer","get","send","req","replyId","replyChannel","decide","flatMap","isShuttingDown","isGoingDown","fail","EntityNotManagedByThisPod","entityScope","extend","executionFiber","ensuring","interrupt","update","remove","use","someQueue","interruptionFiber","fiber","tap","millis","catchAllCause","e","logDebug","zipLeft","end","replyId_","initReply","test","bind","_tag","unlessEffect","isEntityOnLocalShards","unit","die","Do","terminateAllEntities","terminateEntities","keySet","entitiesToTerminate","forEach","logError","name","toMillis","entityTerminationTimeout","timeout","await","concurrency","terminateEntitiesOnShards","shards","modify","filter","has","getShardId","self"],"sources":["../../src/EntityManager.ts"],"sourcesContent":[null],"mappings":"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"}