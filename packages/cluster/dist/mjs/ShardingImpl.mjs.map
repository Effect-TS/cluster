{"version":3,"file":"ShardingImpl.mjs","names":["EntityManager","Message","PodAddress","Pods","RecipientType","Serialization","SerializedEnvelope","ShardId","Sharding","ShardingConfig","ShardingError","ShardingRegistrationEvent","ShardManagerClient","Storage","MessageReturnedNotingDefect","NotAMessageWithReplierDefect","showHashSet","Duration","Effect","Equal","equals","Fiber","pipe","HashMap","HashSet","Layer","List","Option","PubSub","Ref","Schedule","Stream","Synchronized","make","layerScope","address","config","shardAssignments","entityManagers","singletons","isShuttingDownRef","shardManager","pods","storage","serialization","eventsHub","decodeRequest","envelope","get","map","entityType","flatMap","_","unified","match","onNone","fail","ShardingErrorEntityTypeNotRegistered","onSome","entityManager","decode","recipientType","schema","body","request","encodeReply","reply","isNone","succeed","none","isMessage","die","encode","replier","some","decodeReply","value","getShardId","entityId","numberOfShards","register","logDebug","show","zipRight","set","unregister","getAssignments","matchCauseEffect","onFailure","logWarning","onSuccess","forEach","name","terminateAllEntities","catchAllCause","logError","discard","isSingletonNode","startSingletonsIfNeeded","updateEffect","run","maybeExecutionFiber","forkIn","fiber","fromIterable","whenEffect","asUnit","stopSingletonsIfNeeded","as","interrupt","unlessEffect","registerSingleton","context","update","list","prepend","provide","zipLeft","publish","SingletonRegistered","isShuttingDown","assign","shards","reduce","shardId","unassign","isSome","remove","isEntityOnLocalShards","Do","bind","let","pod","getPods","values","updateAssignments","assignmentsOpt","fromShardManager","assignments","v","getOrElse","isEmpty","union","filter","refreshAssignments","fromEffect","merge","assignmentsStream","mapEffect","tap","runDrain","retry","fixed","refreshAssignmentsRetryInterval","interruptible","forkScoped","sendToLocalEntity","gen","send","replyId","sendToPod","recipientTypeName","msg","msgSchema","simulateRemotePods","bytes","errorHandling","sendMessage","tapError","messenger","sendTimeout","timeout","sendDiscard","id","timeoutFail","onTimeout","ShardingErrorSendTimeout","duration","trySend","catchSome","isShardingErrorEntityNotManagedByThisPod","isShardingErrorPodUnavailable","sleep","millis","response","broadcaster","topicType","topic","either","res","concurrency","broadcastDiscard","broadcast","registerEntity","behavior","options","registerRecipient","EntityRegistered","registerTopic","TopicRegistered","getShardingRegistrationEvents","fromPubSub","$","self","registerScoped","acquireRelease","orDie","live","scoped","shardsCache","empty","shuttingDown","unbounded","nil","scope","addFinalizer","__","fa","unit","sharding","selfHost","shardingPort"],"sources":["../src/ShardingImpl.ts"],"sourcesContent":[null],"mappings":"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"}