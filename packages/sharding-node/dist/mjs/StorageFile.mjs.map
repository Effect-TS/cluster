{"version":3,"file":"StorageFile.mjs","names":["Schema","Pod","PodAddress","ShardId","Storage","Effect","pipe","HashMap","Layer","Queue","Stream","fs","jsonParse","jsonStringify","PODS_FILE","ASSIGNMENTS_FILE","AssignmentsSchema","array","tuple","schema","optionFromNullable","PodsSchema","writeJsonData","fileName","data","flatMap","sync","writeFileSync","orDie","readJsonData","empty","existsSync","exists","readFileSync","toString","succeed","getAssignments","map","fromIterable","saveAssignments","assignments","Array","from","getPods","savePods","pods","getChangesStream","unbounded","queue","acquireRelease","watchFile","runSync","offer","watcher","zip","shutdown","unref","concurrent","_","fromQueue","unwrapScoped","assignmentsStream","mapEffect","storageFile","scoped"],"sources":["../src/StorageFile.ts"],"sourcesContent":[null],"mappings":"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"}