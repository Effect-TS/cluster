{"version":3,"file":"StorageFile.mjs","names":["Pod","PodAddress","ShardId","ShardingError","Storage","Schema","TreeFormatter","Effect","pipe","HashMap","Layer","Queue","Stream","fs","jsonStringify","value","schema","encode","mapError","e","ShardingErrorSerialization","formatErrors","errors","map","_","JSON","stringify","jsonParse","sync","parse","flatMap","decode","PODS_FILE","ASSIGNMENTS_FILE","AssignmentsSchema","array","tuple","optionFromNullable","PodsSchema","writeJsonData","fileName","data","writeFileSync","orDie","readJsonData","empty","existsSync","exists","readFileSync","toString","succeed","getAssignments","fromIterable","saveAssignments","assignments","Array","from","getPods","savePods","pods","getChangesStream","unbounded","queue","acquireRelease","watchFile","runSync","offer","watcher","zip","shutdown","unref","concurrent","fromQueue","unwrapScoped","assignmentsStream","mapEffect","storageFile","scoped"],"sources":["../src/StorageFile.ts"],"sourcesContent":[null],"mappings":"AAAA;;;AAGA,OAAO,KAAKA,GAAG,MAAM,qBAAqB;AAC1C,OAAO,KAAKC,UAAU,MAAM,4BAA4B;AACxD,OAAO,KAAKC,OAAO,MAAM,yBAAyB;AAClD,OAAO,KAAKC,aAAa,MAAM,+BAA+B;AAC9D,OAAO,KAAKC,OAAO,MAAM,yBAAyB;AAClD,OAAO,KAAKC,MAAM,MAAM,uBAAuB;AAC/C,OAAO,KAAKC,aAAa,MAAM,8BAA8B;AAC7D,OAAO,KAAKC,MAAM,MAAM,eAAe;AACvC,SAASC,IAAI,QAAQ,iBAAiB;AACtC,OAAO,KAAKC,OAAO,MAAM,gBAAgB;AACzC,OAAO,KAAKC,KAAK,MAAM,cAAc;AAErC,OAAO,KAAKC,KAAK,MAAM,cAAc;AACrC,OAAO,KAAKC,MAAM,MAAM,eAAe;AACvC,OAAO,KAAKC,EAAE,MAAM,IAAI;AAExB;AACA,OAAM,SAAUC,aAAaA,CAAOC,KAAQ,EAAEC,MAA2B;EACvE,OAAOR,IAAI,CACTO,KAAK,EACLV,MAAM,CAACY,MAAM,CAACD,MAAM,CAAC,EACrBT,MAAM,CAACW,QAAQ,CAAEC,CAAC,IAAKhB,aAAa,CAACiB,0BAA0B,CAACd,aAAa,CAACe,YAAY,CAACF,CAAC,CAACG,MAAM,CAAC,CAAC,CAAC,EACtGf,MAAM,CAACgB,GAAG,CAAEC,CAAC,IAAKC,IAAI,CAACC,SAAS,CAACF,CAAC,CAAC,CAAC,CACrC;AACH;AAEA;AACA,OAAM,SAAUG,SAASA,CAAOZ,KAAa,EAAEC,MAA2B;EACxE,OAAOR,IAAI,CACTD,MAAM,CAACqB,IAAI,CAAC,MAAMH,IAAI,CAACI,KAAK,CAACd,KAAK,CAAC,CAAC,EACpCR,MAAM,CAACuB,OAAO,CAACzB,MAAM,CAAC0B,MAAM,CAACf,MAAM,CAAC,CAAC,EACrCT,MAAM,CAACW,QAAQ,CAAEC,CAAC,IAAKhB,aAAa,CAACiB,0BAA0B,CAACd,aAAa,CAACe,YAAY,CAACF,CAAC,CAACG,MAAM,CAAC,CAAC,CAAC,CACvG;AACH;AAEA,MAAMU,SAAS,GAAG,WAAW;AAC7B,MAAMC,gBAAgB,GAAG,kBAAkB;AAE3C,MAAMC,iBAAiB,gBAAG7B,MAAM,CAAC8B,KAAK,eACpC9B,MAAM,CAAC+B,KAAK,CAAClC,OAAO,CAACc,MAAM,eAAEX,MAAM,CAACgC,kBAAkB,CAACpC,UAAU,CAACe,MAAM,CAAC,CAAC,CAC3E;AAED,MAAMsB,UAAU,gBAAGjC,MAAM,CAAC8B,KAAK,eAAC9B,MAAM,CAAC+B,KAAK,CAACnC,UAAU,CAACe,MAAM,EAAEhB,GAAG,CAACgB,MAAM,CAAC,CAAC;AAE5E,SAASuB,aAAaA,CAAOC,QAAgB,EAAExB,MAA2B,EAAEyB,IAAO;EACjF,OAAOjC,IAAI,CACTM,aAAa,CAAC2B,IAAI,EAAEzB,MAAM,CAAC,EAC3BT,MAAM,CAACuB,OAAO,CAAEW,IAAI,IAAKlC,MAAM,CAACqB,IAAI,CAAC,MAAMf,EAAE,CAAC6B,aAAa,CAACF,QAAQ,EAAEC,IAAI,CAAC,CAAC,CAAC,EAC7ElC,MAAM,CAACoC,KAAK,CACb;AACH;AAEA,SAASC,YAAYA,CAAOJ,QAAgB,EAAExB,MAA2B,EAAE6B,KAAQ;EACjF,OAAOrC,IAAI,CACTD,MAAM,CAACqB,IAAI,CAAC,MAAMf,EAAE,CAACiC,UAAU,CAACN,QAAQ,CAAC,CAAC,EAC1CjC,MAAM,CAACuB,OAAO,CAAEiB,MAAM,IACpBA,MAAM,GACFvC,IAAI,CACJD,MAAM,CAACqB,IAAI,CAAC,MAAMf,EAAE,CAACmC,YAAY,CAACR,QAAQ,CAAC,CAAC,EAC5CjC,MAAM,CAACuB,OAAO,CAAEW,IAAI,IAAKd,SAAS,CAACc,IAAI,CAACQ,QAAQ,EAAE,EAAEjC,MAAM,CAAC,CAAC,CAC7D,GACCT,MAAM,CAAC2C,OAAO,CAACL,KAAK,CAAC,CAC1B,EACDtC,MAAM,CAACoC,KAAK,CACb;AACH;AAEA,MAAMQ,cAAc,gBAIhB3C,IAAI,eAACoC,YAAY,CAACX,gBAAgB,EAAEC,iBAAiB,EAAE,EAAE,CAAC,eAAE3B,MAAM,CAACgB,GAAG,CAACd,OAAO,CAAC2C,YAAY,CAAC,CAAC;AAEjG,SAASC,eAAeA,CACtBC,WAAmF;EAEnF,OAAOf,aAAa,CAACN,gBAAgB,EAAEC,iBAAiB,EAAEqB,KAAK,CAACC,IAAI,CAACF,WAAW,CAAC,CAAC;AACpF;AAEA,MAAMG,OAAO,gBAAiFjD,IAAI,eAChGoC,YAAY,CAACZ,SAAS,EAAEM,UAAU,EAAE,EAAE,CAAC,eACvC/B,MAAM,CAACgB,GAAG,CAACd,OAAO,CAAC2C,YAAY,CAAC,CACjC;AAED,SAASM,QAAQA,CACfC,IAAqD;EAErD,OAAOpB,aAAa,CAAC,WAAW,EAAED,UAAU,EAAEiB,KAAK,CAACC,IAAI,CAACG,IAAI,CAAC,CAAC;AACjE;AAEA;;;;AAKA,SAASC,gBAAgBA,CAACpB,QAAgB;EACxC,OAAOhC,IAAI,CACTG,KAAK,CAACkD,SAAS,EAAW,EAC1BtD,MAAM,CAACuB,OAAO,CAAEgC,KAAK,IACnBtD,IAAI,CACFD,MAAM,CAACwD,cAAc,CACnBxD,MAAM,CAACqB,IAAI,CACT,MAAM,CAACf,EAAE,CAACmD,SAAS,CAACxB,QAAQ,EAAE,MAAMjC,MAAM,CAAC0D,OAAO,CAACH,KAAK,CAACI,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,EAAEJ,KAAK,CAAU,CACxF,EACD,CAAC,CAACK,OAAO,EAAEL,KAAK,CAAC,KACfvD,MAAM,CAAC6D,GAAG,CACRN,KAAK,CAACO,QAAQ,EAAE,EAChB9D,MAAM,CAACqB,IAAI,CAAC,MAAMuC,OAAO,CAACG,KAAK,EAAE,CAAC,EAClC;IAAEC,UAAU,EAAE;EAAI,CAAE,CACrB,CACJ,EACDhE,MAAM,CAACgB,GAAG,CAAC,CAAC,CAACC,CAAC,EAAEsC,KAAK,CAAC,KAAKlD,MAAM,CAAC4D,SAAS,CAACV,KAAK,CAAC,CAAC,CACpD,CACF,EACDlD,MAAM,CAAC6D,YAAY,CACpB;AACH;AAEA,MAAMC,iBAAiB,gBAAGlE,IAAI,eAC5BoD,gBAAgB,CAAC3B,gBAAgB,CAAC,eAClCrB,MAAM,CAAC+D,SAAS,CAAC,MAAMxB,cAAc,CAAC,CACvC;AAED;;;;AAIA,OAAO,MAAMyB,WAAW,gBAAGlE,KAAK,CAACmE,MAAM,CACrCzE,OAAO,CAACA,OAAO,eACfG,MAAM,CAAC2C,OAAO,CAAC;EACbC,cAAc;EACdE,eAAe;EACfqB,iBAAiB;EACjBjB,OAAO;EACPC;CACD,CAAC,CACH"}