{"version":3,"file":"StorageFile.js","names":["Pod","_interopRequireWildcard","require","PodAddress","ShardId","ShardingError","Storage","Schema","TreeFormatter","Effect","_Function","HashMap","Layer","Queue","Stream","fs","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","jsonStringify","value","schema","pipe","encode","mapError","e","ShardingErrorSerialization","formatErrors","errors","map","_","JSON","stringify","jsonParse","sync","parse","flatMap","decode","PODS_FILE","ASSIGNMENTS_FILE","AssignmentsSchema","array","tuple","optionFromNullable","PodsSchema","writeJsonData","fileName","data","writeFileSync","orDie","readJsonData","empty","existsSync","exists","readFileSync","toString","succeed","getAssignments","fromIterable","saveAssignments","assignments","Array","from","getPods","savePods","pods","getChangesStream","unbounded","queue","acquireRelease","watchFile","runSync","offer","watcher","zip","shutdown","unref","concurrent","fromQueue","unwrapScoped","assignmentsStream","mapEffect","storageFile","scoped","exports"],"sources":["./src/StorageFile.ts"],"sourcesContent":[null],"mappings":";;;;;;;;AAGA,IAAAA,GAAA,gBAAAC,uBAAA,eAAAC,OAAA;AACA,IAAAC,UAAA,gBAAAF,uBAAA,eAAAC,OAAA;AACA,IAAAE,OAAA,gBAAAH,uBAAA,eAAAC,OAAA;AACA,IAAAG,aAAA,gBAAAJ,uBAAA,eAAAC,OAAA;AACA,IAAAI,OAAA,gBAAAL,uBAAA,eAAAC,OAAA;AACA,IAAAK,MAAA,gBAAAN,uBAAA,eAAAC,OAAA;AACA,IAAAM,aAAA,gBAAAP,uBAAA,eAAAC,OAAA;AACA,IAAAO,MAAA,gBAAAR,uBAAA,eAAAC,OAAA;AACA,IAAAQ,SAAA,gBAAAR,OAAA;AACA,IAAAS,OAAA,gBAAAV,uBAAA,eAAAC,OAAA;AACA,IAAAU,KAAA,gBAAAX,uBAAA,eAAAC,OAAA;AAEA,IAAAW,KAAA,gBAAAZ,uBAAA,eAAAC,OAAA;AACA,IAAAY,MAAA,gBAAAb,uBAAA,eAAAC,OAAA;AACA,IAAAa,EAAA,gBAAAd,uBAAA,eAAAC,OAAA;AAAwB,SAAAc,yBAAAC,WAAA,eAAAC,OAAA,kCAAAC,iBAAA,OAAAD,OAAA,QAAAE,gBAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,WAAA,WAAAA,WAAA,GAAAG,gBAAA,GAAAD,iBAAA,KAAAF,WAAA;AAAA,SAAAhB,wBAAAoB,GAAA,EAAAJ,WAAA,SAAAA,WAAA,IAAAI,GAAA,IAAAA,GAAA,CAAAC,UAAA,WAAAD,GAAA,QAAAA,GAAA,oBAAAA,GAAA,wBAAAA,GAAA,4BAAAE,OAAA,EAAAF,GAAA,UAAAG,KAAA,GAAAR,wBAAA,CAAAC,WAAA,OAAAO,KAAA,IAAAA,KAAA,CAAAC,GAAA,CAAAJ,GAAA,YAAAG,KAAA,CAAAE,GAAA,CAAAL,GAAA,SAAAM,MAAA,WAAAC,qBAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,GAAA,IAAAX,GAAA,QAAAW,GAAA,kBAAAH,MAAA,CAAAI,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAd,GAAA,EAAAW,GAAA,SAAAI,IAAA,GAAAR,qBAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAV,GAAA,EAAAW,GAAA,cAAAI,IAAA,KAAAA,IAAA,CAAAV,GAAA,IAAAU,IAAA,CAAAC,GAAA,KAAAR,MAAA,CAAAC,cAAA,CAAAH,MAAA,EAAAK,GAAA,EAAAI,IAAA,YAAAT,MAAA,CAAAK,GAAA,IAAAX,GAAA,CAAAW,GAAA,SAAAL,MAAA,CAAAJ,OAAA,GAAAF,GAAA,MAAAG,KAAA,IAAAA,KAAA,CAAAa,GAAA,CAAAhB,GAAA,EAAAM,MAAA,YAAAA,MAAA;AAjBxB;;;;AAmBA;AACM,SAAUW,aAAaA,CAAOC,KAAQ,EAAEC,MAA2B;EACvE,OAAO,IAAAC,cAAI,EACTF,KAAK,EACLhC,MAAM,CAACmC,MAAM,CAACF,MAAM,CAAC,EACrB/B,MAAM,CAACkC,QAAQ,CAAEC,CAAC,IAAKvC,aAAa,CAACwC,0BAA0B,CAACrC,aAAa,CAACsC,YAAY,CAACF,CAAC,CAACG,MAAM,CAAC,CAAC,CAAC,EACtGtC,MAAM,CAACuC,GAAG,CAAEC,CAAC,IAAKC,IAAI,CAACC,SAAS,CAACF,CAAC,CAAC,CAAC,CACrC;AACH;AAEA;AACM,SAAUG,SAASA,CAAOb,KAAa,EAAEC,MAA2B;EACxE,OAAO,IAAAC,cAAI,EACThC,MAAM,CAAC4C,IAAI,CAAC,MAAMH,IAAI,CAACI,KAAK,CAACf,KAAK,CAAC,CAAC,EACpC9B,MAAM,CAAC8C,OAAO,CAAChD,MAAM,CAACiD,MAAM,CAAChB,MAAM,CAAC,CAAC,EACrC/B,MAAM,CAACkC,QAAQ,CAAEC,CAAC,IAAKvC,aAAa,CAACwC,0BAA0B,CAACrC,aAAa,CAACsC,YAAY,CAACF,CAAC,CAACG,MAAM,CAAC,CAAC,CAAC,CACvG;AACH;AAEA,MAAMU,SAAS,GAAG,WAAW;AAC7B,MAAMC,gBAAgB,GAAG,kBAAkB;AAE3C,MAAMC,iBAAiB,gBAAGpD,MAAM,CAACqD,KAAK,eACpCrD,MAAM,CAACsD,KAAK,CAACzD,OAAO,CAACoC,MAAM,eAAEjC,MAAM,CAACuD,kBAAkB,CAAC3D,UAAU,CAACqC,MAAM,CAAC,CAAC,CAC3E;AAED,MAAMuB,UAAU,gBAAGxD,MAAM,CAACqD,KAAK,eAACrD,MAAM,CAACsD,KAAK,CAAC1D,UAAU,CAACqC,MAAM,EAAExC,GAAG,CAACwC,MAAM,CAAC,CAAC;AAE5E,SAASwB,aAAaA,CAAOC,QAAgB,EAAEzB,MAA2B,EAAE0B,IAAO;EACjF,OAAO,IAAAzB,cAAI,EACTH,aAAa,CAAC4B,IAAI,EAAE1B,MAAM,CAAC,EAC3B/B,MAAM,CAAC8C,OAAO,CAAEW,IAAI,IAAKzD,MAAM,CAAC4C,IAAI,CAAC,MAAMtC,EAAE,CAACoD,aAAa,CAACF,QAAQ,EAAEC,IAAI,CAAC,CAAC,CAAC,EAC7EzD,MAAM,CAAC2D,KAAK,CACb;AACH;AAEA,SAASC,YAAYA,CAAOJ,QAAgB,EAAEzB,MAA2B,EAAE8B,KAAQ;EACjF,OAAO,IAAA7B,cAAI,EACThC,MAAM,CAAC4C,IAAI,CAAC,MAAMtC,EAAE,CAACwD,UAAU,CAACN,QAAQ,CAAC,CAAC,EAC1CxD,MAAM,CAAC8C,OAAO,CAAEiB,MAAM,IACpBA,MAAM,GACF,IAAA/B,cAAI,EACJhC,MAAM,CAAC4C,IAAI,CAAC,MAAMtC,EAAE,CAAC0D,YAAY,CAACR,QAAQ,CAAC,CAAC,EAC5CxD,MAAM,CAAC8C,OAAO,CAAEW,IAAI,IAAKd,SAAS,CAACc,IAAI,CAACQ,QAAQ,EAAE,EAAElC,MAAM,CAAC,CAAC,CAC7D,GACC/B,MAAM,CAACkE,OAAO,CAACL,KAAK,CAAC,CAC1B,EACD7D,MAAM,CAAC2D,KAAK,CACb;AACH;AAEA,MAAMQ,cAAc,gBAIhB,IAAAnC,cAAI,gBAAC4B,YAAY,CAACX,gBAAgB,EAAEC,iBAAiB,EAAE,EAAE,CAAC,eAAElD,MAAM,CAACuC,GAAG,CAACrC,OAAO,CAACkE,YAAY,CAAC,CAAC;AAEjG,SAASC,eAAeA,CACtBC,WAAmF;EAEnF,OAAOf,aAAa,CAACN,gBAAgB,EAAEC,iBAAiB,EAAEqB,KAAK,CAACC,IAAI,CAACF,WAAW,CAAC,CAAC;AACpF;AAEA,MAAMG,OAAO,gBAAiF,IAAAzC,cAAI,gBAChG4B,YAAY,CAACZ,SAAS,EAAEM,UAAU,EAAE,EAAE,CAAC,eACvCtD,MAAM,CAACuC,GAAG,CAACrC,OAAO,CAACkE,YAAY,CAAC,CACjC;AAED,SAASM,QAAQA,CACfC,IAAqD;EAErD,OAAOpB,aAAa,CAAC,WAAW,EAAED,UAAU,EAAEiB,KAAK,CAACC,IAAI,CAACG,IAAI,CAAC,CAAC;AACjE;AAEA;;;;AAKA,SAASC,gBAAgBA,CAACpB,QAAgB;EACxC,OAAO,IAAAxB,cAAI,EACT5B,KAAK,CAACyE,SAAS,EAAW,EAC1B7E,MAAM,CAAC8C,OAAO,CAAEgC,KAAK,IACnB,IAAA9C,cAAI,EACFhC,MAAM,CAAC+E,cAAc,CACnB/E,MAAM,CAAC4C,IAAI,CACT,MAAM,CAACtC,EAAE,CAAC0E,SAAS,CAACxB,QAAQ,EAAE,MAAMxD,MAAM,CAACiF,OAAO,CAACH,KAAK,CAACI,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,EAAEJ,KAAK,CAAU,CACxF,EACD,CAAC,CAACK,OAAO,EAAEL,KAAK,CAAC,KACf9E,MAAM,CAACoF,GAAG,CACRN,KAAK,CAACO,QAAQ,EAAE,EAChBrF,MAAM,CAAC4C,IAAI,CAAC,MAAMuC,OAAO,CAACG,KAAK,EAAE,CAAC,EAClC;IAAEC,UAAU,EAAE;EAAI,CAAE,CACrB,CACJ,EACDvF,MAAM,CAACuC,GAAG,CAAC,CAAC,CAACC,CAAC,EAAEsC,KAAK,CAAC,KAAKzE,MAAM,CAACmF,SAAS,CAACV,KAAK,CAAC,CAAC,CACpD,CACF,EACDzE,MAAM,CAACoF,YAAY,CACpB;AACH;AAEA,MAAMC,iBAAiB,gBAAG,IAAA1D,cAAI,gBAC5B4C,gBAAgB,CAAC3B,gBAAgB,CAAC,eAClC5C,MAAM,CAACsF,SAAS,CAAC,MAAMxB,cAAc,CAAC,CACvC;AAED;;;;AAIO,MAAMyB,WAAW,gBAAGzF,KAAK,CAAC0F,MAAM,CACrChG,OAAO,CAACA,OAAO,eACfG,MAAM,CAACkE,OAAO,CAAC;EACbC,cAAc;EACdE,eAAe;EACfqB,iBAAiB;EACjBjB,OAAO;EACPC;CACD,CAAC,CACH;AAAAoB,OAAA,CAAAF,WAAA,GAAAA,WAAA"}